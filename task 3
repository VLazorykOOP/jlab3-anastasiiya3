import java.util.Arrays;

// Інтерфейс замість абстрактного класу
interface IntegerNumberInterface {
    IntegerNumberInterface add(IntegerNumberInterface other);
    IntegerNumberInterface subtract(IntegerNumberInterface other);
    IntegerNumberInterface multiply(IntegerNumberInterface other);
    int toDecimal();
    int[] getDigits();
}

// Базовий клас з реалізацією спільних методів
abstract class AbstractNumber implements IntegerNumberInterface {
    protected int[] digits;
    
    public AbstractNumber(int[] digits) {
        this.digits = digits.clone();
    }
    
    public int[] getDigits() {
        return digits.clone();
    }
    
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        AbstractNumber that = (AbstractNumber) obj;
        return Arrays.equals(digits, that.digits);
    }
    
    @Override
    public abstract String toString();
}

// Клас для шістнадцяткових чисел (з використанням інтерфейсу)
class HexNumberInterface extends AbstractNumber {
    public HexNumberInterface(int[] digits) {
        super(validateHexDigits(digits));
    }
    
    public HexNumberInterface(String hexString) {
        super(parseHexString(hexString));
    }
    
    private static int[] validateHexDigits(int[] digits) {
        for (int digit : digits) {
            if (digit < 0 || digit > 15) {
                throw new IllegalArgumentException("Шістнадцяткова цифра повинна бути від 0 до 15");
            }
        }
        return digits;
    }
    
    private static int[] parseHexString(String hexString) {
        hexString = hexString.toUpperCase().replaceAll("^0x", "");
        int[] digits = new int[hexString.length()];
        for (int i = 0; i < hexString.length(); i++) {
            char c = hexString.charAt(i);
            if (c >= '0' && c <= '9') {
                digits[i] = c - '0';
            } else if (c >= 'A' && c <= 'F') {
                digits[i] = 10 + (c - 'A');
            } else {
                throw new IllegalArgumentException("Невірний шістнадцятковий символ: " + c);
            }
        }
        return digits;
    }
    
    @Override
    public IntegerNumberInterface add(IntegerNumberInterface other) {
        if (!(other instanceof HexNumberInterface)) {
            throw new IllegalArgumentException("Можна додавати тільки шістнадцяткові числа");
        }
        int result = this.toDecimal() + other.toDecimal();
        return new HexNumberInterface(Integer.toHexString(result).toUpperCase());
    }
    
    @Override
    public IntegerNumberInterface subtract(IntegerNumberInterface other) {
        if (!(other instanceof HexNumberInterface)) {
            throw new IllegalArgumentException("Можна віднімати тільки шістнадцяткові числа");
        }
        int result = this.toDecimal() - other.toDecimal();
        return new HexNumberInterface(Integer.toHexString(Math.max(result, 0)).toUpperCase());
    }
    
    @Override
    public IntegerNumberInterface multiply(IntegerNumberInterface other) {
        if (!(other instanceof HexNumberInterface)) {
            throw new IllegalArgumentException("Можна множити тільки шістнадцяткові числа");
        }
        int result = this.toDecimal() * other.toDecimal();
        return new HexNumberInterface(Integer.toHexString(result).toUpperCase());
    }
    
    @Override
    public int toDecimal() {
        int decimal = 0;
        for (int i = 0; i < digits.length; i++) {
            decimal = decimal * 16 + digits[i];
        }
        return decimal;
    }
    
    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder("0x");
        for (int digit : digits) {
            if (digit < 10) {
                sb.append(digit);
            } else {
                sb.append((char) ('A' + digit - 10));
            }
        }
        return sb.toString();
    }
}

// Клас для двійкових чисел (з використанням інтерфейсу)
class BinaryNumberInterface extends AbstractNumber {
    public BinaryNumberInterface(int[] digits) {
        super(validateBinaryDigits(digits));
    }
    
    public BinaryNumberInterface(String binaryString) {
        super(parseBinaryString(binaryString));
    }
    
    private static int[] validateBinaryDigits(int[] digits) {
        for (int digit : digits) {
            if (digit != 0 && digit != 1) {
                throw new IllegalArgumentException("Двійкова цифра повинна бути 0 або 1");
            }
        }
        return digits;
    }
    
    private static int[] parseBinaryString(String binaryString) {
        binaryString = binaryString.replaceAll("^0b", "");
        int[] digits = new int[binaryString.length()];
        for (int i = 0; i < binaryString.length(); i++) {
            char c = binaryString.charAt(i);
            if (c == '0' || c == '1') {
                digits[i] = c - '0';
            } else {
                throw new IllegalArgumentException("Невірний двійковий символ: " + c);
            }
        }
        return digits;
    }
    
    @Override
    public IntegerNumberInterface add(IntegerNumberInterface other) {
        if (!(other instanceof BinaryNumberInterface)) {
            throw new IllegalArgumentException("Можна додавати тільки двійкові числа");
        }
        int result = this.toDecimal() + other.toDecimal();
        return new BinaryNumberInterface(Integer.toBinaryString(result));
    }
    
    @Override
    public IntegerNumberInterface subtract(IntegerNumberInterface other) {
        if (!(other instanceof BinaryNumberInterface)) {
            throw new IllegalArgumentException("Можна віднімати тільки двійкові числа");
        }
        int result = this.toDecimal() - other.toDecimal();
        return new BinaryNumberInterface(Integer.toBinaryString(Math.max(result, 0)));
    }
    
    @Override
    public IntegerNumberInterface multiply(IntegerNumberInterface other) {
        if (!(other instanceof BinaryNumberInterface)) {
            throw new IllegalArgumentException("Можна множити тільки двійкові числа");
        }
        int result = this.toDecimal() * other.toDecimal();
        return new BinaryNumberInterface(Integer.toBinaryString(result));
    }
    
    @Override
    public int toDecimal() {
        int decimal = 0;
        for (int i = 0; i < digits.length; i++) {
            decimal = decimal * 2 + digits[i];
        }
        return decimal;
    }
    
    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder("0b");
        for (int digit : digits) {
            sb.append(digit);
        }
        return sb.toString();
    }
}

// Головний клас програми
public class Task3 {
    public static void main(String[] args) {
        // Створення масиву чисел через інтерфейс
        IntegerNumberInterface[] numbers = new IntegerNumberInterface[4];
        
        numbers[0] = new HexNumberInterface("1A");
        numbers[1] = new HexNumberInterface("B3");
        numbers[2] = new BinaryNumberInterface("1110");
        numbers[3] = new BinaryNumberInterface("1011");
        
        // Демонстрація роботи методів
        System.out.println("=== ДЕМОНСТРАЦІЯ РОБОТИ МЕТОДІВ (ІНТЕРФЕЙС) ===\n");
        
        for (int i = 0; i < numbers.length; i++) {
            System.out.println("Число " + (i + 1) + ": " + numbers[i]);
            System.out.println("У десятковій системі: " + numbers[i].toDecimal());
        }
        
        // Операції з шістнадцятковими числами
        System.out.println("\n=== ОПЕРАЦІЇ З ШІСТНАДЦЯТКОВИМИ ЧИСЛАМИ ===");
        HexNumberInterface hex1 = (HexNumberInterface) numbers[0];
        HexNumberInterface hex2 = (HexNumberInterface) numbers[1];
        
        System.out.println(hex1 + " + " + hex2 + " = " + hex1.add(hex2));
        System.out.println(hex1 + " - " + hex2 + " = " + hex1.subtract(hex2));
        System.out.println(hex1 + " * " + hex2 + " = " + hex1.multiply(hex2));
        
        // Операції з двійковими числами
        System.out.println("\n=== ОПЕРАЦІЇ З ДВІЙКОВИМИ ЧИСЛАМИ ===");
        BinaryNumberInterface bin1 = (BinaryNumberInterface) numbers[2];
        BinaryNumberInterface bin2 = (BinaryNumberInterface) numbers[3];
        
        System.out.println(bin1 + " + " + bin2 + " = " + bin1.add(bin2));
        System.out.println(bin1 + " - " + bin2 + " = " + bin1.subtract(bin2));
        System.out.println(bin1 + " * " + bin2 + " = " + bin1.multiply(bin2));
        
        // Перевірка поліморфізму
        System.out.println("\n=== ПЕРЕВІРКА ПОЛІМОРФІЗМУ ===");
        demonstratePolymorphism(numbers);
    }
    
    public static void demonstratePolymorphism(IntegerNumberInterface[] numbers) {
        for (IntegerNumberInterface number : numbers) {
            System.out.println("Число: " + number + ", Десяткове значення: " + number.toDecimal());
        }
    }
}
