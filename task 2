import java.util.Arrays;

// Абстрактний базовий клас
abstract class IntegerNumber {
    protected int[] digits;
    
    public IntegerNumber(int[] digits) {
        this.digits = digits.clone();
    }
    
    // Абстрактні методи
    public abstract IntegerNumber add(IntegerNumber other);
    public abstract IntegerNumber subtract(IntegerNumber other);
    public abstract IntegerNumber multiply(IntegerNumber other);
    
    // Перетворення в десяткове число
    public abstract int toDecimal();
    
    // Геттер для цифр
    public int[] getDigits() {
        return digits.clone();
    }
    
    @Override
    public abstract String toString();
    
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        IntegerNumber that = (IntegerNumber) obj;
        return Arrays.equals(digits, that.digits);
    }
}

// Клас для шістнадцяткових чисел
class HexNumber extends IntegerNumber {
    public HexNumber(int[] digits) {
        super(validateHexDigits(digits));
    }
    
    public HexNumber(String hexString) {
        super(parseHexString(hexString));
    }
    
    private static int[] validateHexDigits(int[] digits) {
        for (int digit : digits) {
            if (digit < 0 || digit > 15) {
                throw new IllegalArgumentException("Шістнадцяткова цифра повинна бути від 0 до 15");
            }
        }
        return digits;
    }
    
    private static int[] parseHexString(String hexString) {
        hexString = hexString.toUpperCase().replaceAll("^0x", "");
        int[] digits = new int[hexString.length()];
        for (int i = 0; i < hexString.length(); i++) {
            char c = hexString.charAt(i);
            if (c >= '0' && c <= '9') {
                digits[i] = c - '0';
            } else if (c >= 'A' && c <= 'F') {
                digits[i] = 10 + (c - 'A');
            } else {
                throw new IllegalArgumentException("Невірний шістнадцятковий символ: " + c);
            }
        }
        return digits;
    }
    
    @Override
    public IntegerNumber add(IntegerNumber other) {
        if (!(other instanceof HexNumber)) {
            throw new IllegalArgumentException("Можна додавати тільки шістнадцяткові числа");
        }
        int result = this.toDecimal() + other.toDecimal();
        return new HexNumber(Integer.toHexString(result).toUpperCase());
    }
    
    @Override
    public IntegerNumber subtract(IntegerNumber other) {
        if (!(other instanceof HexNumber)) {
            throw new IllegalArgumentException("Можна віднімати тільки шістнадцяткові числа");
        }
        int result = this.toDecimal() - other.toDecimal();
        return new HexNumber(Integer.toHexString(Math.max(result, 0)).toUpperCase());
    }
    
    @Override
    public IntegerNumber multiply(IntegerNumber other) {
        if (!(other instanceof HexNumber)) {
            throw new IllegalArgumentException("Можна множити тільки шістнадцяткові числа");
        }
        int result = this.toDecimal() * other.toDecimal();
        return new HexNumber(Integer.toHexString(result).toUpperCase());
    }
    
    @Override
    public int toDecimal() {
        int decimal = 0;
        for (int i = 0; i < digits.length; i++) {
            decimal = decimal * 16 + digits[i];
        }
        return decimal;
    }
    
    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder("0x");
        for (int digit : digits) {
            if (digit < 10) {
                sb.append(digit);
            } else {
                sb.append((char) ('A' + digit - 10));
            }
        }
        return sb.toString();
    }
    
    @Override
    public boolean equals(Object obj) {
        return super.equals(obj);
    }
}

// Клас для двійкових чисел
class BinaryNumber extends IntegerNumber {
    public BinaryNumber(int[] digits) {
        super(validateBinaryDigits(digits));
    }
    
    public BinaryNumber(String binaryString) {
        super(parseBinaryString(binaryString));
    }
    
    private static int[] validateBinaryDigits(int[] digits) {
        for (int digit : digits) {
            if (digit != 0 && digit != 1) {
                throw new IllegalArgumentException("Двійкова цифра повинна бути 0 або 1");
            }
        }
        return digits;
    }
    
    private static int[] parseBinaryString(String binaryString) {
        binaryString = binaryString.replaceAll("^0b", "");
        int[] digits = new int[binaryString.length()];
        for (int i = 0; i < binaryString.length(); i++) {
            char c = binaryString.charAt(i);
            if (c == '0' || c == '1') {
                digits[i] = c - '0';
            } else {
                throw new IllegalArgumentException("Невірний двійковий символ: " + c);
            }
        }
        return digits;
    }
    
    @Override
    public IntegerNumber add(IntegerNumber other) {
        if (!(other instanceof BinaryNumber)) {
            throw new IllegalArgumentException("Можна додавати тільки двійкові числа");
        }
        int result = this.toDecimal() + other.toDecimal();
        return new BinaryNumber(Integer.toBinaryString(result));
    }
    
    @Override
    public IntegerNumber subtract(IntegerNumber other) {
        if (!(other instanceof BinaryNumber)) {
            throw new IllegalArgumentException("Можна віднімати тільки двійкові числа");
        }
        int result = this.toDecimal() - other.toDecimal();
        return new BinaryNumber(Integer.toBinaryString(Math.max(result, 0)));
    }
    
    @Override
    public IntegerNumber multiply(IntegerNumber other) {
        if (!(other instanceof BinaryNumber)) {
            throw new IllegalArgumentException("Можна множити тільки двійкові числа");
        }
        int result = this.toDecimal() * other.toDecimal();
        return new BinaryNumber(Integer.toBinaryString(result));
    }
    
    @Override
    public int toDecimal() {
        int decimal = 0;
        for (int i = 0; i < digits.length; i++) {
            decimal = decimal * 2 + digits[i];
        }
        return decimal;
    }
    
    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder("0b");
        for (int digit : digits) {
            sb.append(digit);
        }
        return sb.toString();
    }
    
    @Override
    public boolean equals(Object obj) {
        return super.equals(obj);
    }
}

// Головний клас програми
public class Task2 {
    public static void main(String[] args) {
        // Створення масиву чисел
        IntegerNumber[] numbers = new IntegerNumber[4];
        
        numbers[0] = new HexNumber("A1");
        numbers[1] = new HexNumber("2F");
        numbers[2] = new BinaryNumber("1010");
        numbers[3] = new BinaryNumber("1101");
        
        // Демонстрація роботи методів
        System.out.println("=== ДЕМОНСТРАЦІЯ РОБОТИ МЕТОДІВ ===\n");
        
        for (int i = 0; i < numbers.length; i++) {
            System.out.println("Число " + (i + 1) + ": " + numbers[i]);
            System.out.println("У десятковій системі: " + numbers[i].toDecimal());
        }
        
        // Операції з шістнадцятковими числами
        System.out.println("\n=== ОПЕРАЦІЇ З ШІСТНАДЦЯТКОВИМИ ЧИСЛАМИ ===");
        HexNumber hex1 = (HexNumber) numbers[0];
        HexNumber hex2 = (HexNumber) numbers[1];
        
        System.out.println(hex1 + " + " + hex2 + " = " + hex1.add(hex2));
        System.out.println(hex1 + " - " + hex2 + " = " + hex1.subtract(hex2));
        System.out.println(hex1 + " * " + hex2 + " = " + hex1.multiply(hex2));
        
        // Операції з двійковими числами
        System.out.println("\n=== ОПЕРАЦІЇ З ДВІЙКОВИМИ ЧИСЛАМИ ===");
        BinaryNumber bin1 = (BinaryNumber) numbers[2];
        BinaryNumber bin2 = (BinaryNumber) numbers[3];
        
        System.out.println(bin1 + " + " + bin2 + " = " + bin1.add(bin2));
        System.out.println(bin1 + " - " + bin2 + " = " + bin1.subtract(bin2));
        System.out.println(bin1 + " * " + bin2 + " = " + bin1.multiply(bin2));
        
        // Перевірка equals
        System.out.println("\n=== ПЕРЕВІРКА METОДУ EQUALS ===");
        HexNumber hex3 = new HexNumber("A1");
        System.out.println(hex1 + " equals " + hex3 + ": " + hex1.equals(hex3));
        System.out.println(hex1 + " equals " + hex2 + ": " + hex1.equals(hex2));
    }
}
